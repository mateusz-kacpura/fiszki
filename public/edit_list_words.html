<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit JSON Data</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .table-responsive {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2>Edit JSON Data</h2>
        <div class="form-group">
            <label for="file">Select a file:</label>
            <input type="file" id="file" accept=".json" class="form-control">
        </div>
        <div class="form-group">
            <label for="language">Select Language:</label>
            <select id="language" class="form-control">
                <option value="English">English</option>
                <option value="Spanish">Spanish</option>
                <option value="French">French</option>
                <option value="German">German</option>
                <option value="Italian">Italian</option>
                <option value="Portuguese">Portuguese</option>
                <option value="Chinese">Chinese</option>
                <option value="Japanese">Japanese</option>
                <option value="Korean">Korean</option>
                <option value="Russian">Russian</option>
                <option value="Arabic">Arabic</option>
                <option value="Hebrew">Hebrew</option>
                <option value="Hindi">Hindi</option>
                <option value="Polish">Polish</option>
                <option value="Dutch">Dutch</option>
                <option value="Swedish">Swedish</option>
                <option value="Danish">Danish</option>
                <option value="Norwegian">Norwegian</option>
                <option value="Finnish">Finnish</option>
                <option value="Greek">Greek</option>
                <option value="Turkish">Turkish</option>
                <option value="Persian">Persian</option>
                <option value="Thai">Thai</option>
                <option value="Vietnamese">Vietnamese</option>
                <option value="Indonesian">Indonesian</option>
                <option value="Malay">Malay</option>
                <option value="Swahili">Swahili</option>
                <option value="Czech">Czech</option>
                <option value="Hungarian">Hungarian</option>
                <option value="Romanian">Romanian</option>
                <option value="Bulgarian">Bulgarian</option>
                <option value="Slovak">Slovak</option>
                <option value="Lithuanian">Lithuanian</option>
                <option value="Latvian">Latvian</option>
                <option value="Estonian">Estonian</option>
                <option value="Icelandic">Icelandic</option>
                <option value="Faroese">Faroese</option>
                <option value="Welsh">Welsh</option>
                <option value="Irish">Irish</option>
                <option value="Scottish Gaelic">Scottish Gaelic</option>
                <!-- Add more languages here -->
            </select>
        </div>

        <div class="form-group">
            <label for="translationLanguage">Select Translation Language:</label>
            <select id="translationLanguage" class="form-control">
                <option value="English">English</option>
                <option value="Spanish">Spanish</option>
                <option value="French">French</option>
                <option value="German">German</option>
                <option value="Italian">Italian</option>
                <option value="Portuguese">Portuguese</option>
                <option value="Chinese">Chinese</option>
                <option value="Japanese">Japanese</option>
                <option value="Korean">Korean</option>
                <option value="Russian">Russian</option>
                <option value="Arabic">Arabic</option>
                <option value="Hebrew">Hebrew</option>
                <option value="Hindi">Hindi</option>
                <option value="Polish">Polish</option>
                <option value="Dutch">Dutch</option>
                <option value="Swedish">Swedish</option>
                <option value="Danish">Danish</option>
                <option value="Norwegian">Norwegian</option>
                <option value="Finnish">Finnish</option>
                <option value="Greek">Greek</option>
                <option value="Turkish">Turkish</option>
                <option value="Persian">Persian</option>
                <option value="Thai">Thai</option>
                <option value="Vietnamese">Vietnamese</option>
                <option value="Indonesian">Indonesian</option>
                <option value="Malay">Malay</option>
                <option value="Swahili">Swahili</option>
                <option value="Czech">Czech</option>
                <option value="Hungarian">Hungarian</option>
                <option value="Romanian">Romanian</option>
                <option value="Bulgarian">Bulgarian</option>
                <option value="Slovak">Slovak</option>
                <option value="Lithuanian">Lithuanian</option>
                <option value="Latvian">Latvian</option>
                <option value="Estonian">Estonian</option>
                <option value="Icelandic">Icelandic</option>
                <option value="Faroese">Faroese</option>
                <option value="Welsh">Welsh</option>
                <option value="Irish">Irish</option>
                <option value="Scottish Gaelic">Scottish Gaelic</option>
                <!-- Add more languages here -->
            </select>
        </div>
        <div class="table-responsive">
            <table id="dataTable" class="table table-bordered"></table>
        </div>
        <div class="form-group">
            <button id="addRow" class="btn btn-success">Add Row</button>
            <button id="deleteRow" class="btn btn-danger">Delete Selected Row</button>
            <button id="loadAudioPaths" class="btn btn-info">Load Audio Paths</button>
            <button id="loadImagePaths" class="btn btn-info">Load Image Paths</button>
            <button id="translateRows" class="btn btn-warning">Translate Rows</button>
        </div>
        <div class="form-group">
            <input type="text" id="fileName" placeholder="Enter file name (with .json)" class="form-control">
        </div>
        <button id="saveChanges" class="btn btn-primary">Save Changes</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('file');
            const dataTable = document.getElementById('dataTable');
            const saveChangesButton = document.getElementById('saveChanges');
            const addRowButton = document.getElementById('addRow');
            const deleteRowButton = document.getElementById('deleteRow');
            const loadAudioPathsButton = document.getElementById('loadAudioPaths');
            const loadImagePathsButton = document.getElementById('loadImagePaths');
            const translateRowsButton = document.getElementById('translateRows');
            const fileNameInput = document.getElementById('fileName');
            const languageSelect = document.getElementById('language');
            const translationLanguageSelect = document.getElementById('translationLanguage');

            let data = [];
            let selectedRowIndex = -1;

            fileInput.addEventListener('change', (e) => {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    const jsonData = JSON.parse(event.target.result);
                    displayData(jsonData);
                };
                reader.readAsText(file);
                console.log('File input changed:', e.target.files[0]);
            });

            function displayData(jsonData) {
                data = jsonData;
                const tableHeader = `
                    <tr>
                        <th>Select</th>
                        <th>Language</th>
                        <th>Translation Language</th>
                        <th>Word</th>
                        <th>Translation</th>
                        <th>Definition</th>
                        <th>Example</th>
                        <th>Image Link</th>
                        <th>Audio Link</th>
                    </tr>
                `;
                let tableRows = '';
                jsonData.forEach((wordData, index) => {
                    tableRows += `
                        <tr>
                            <td><input type="radio" name="rowSelect" class="rowSelect" data-index="${index}"></td>
                            <td>${wordData.language || ''}</td>
                            <td>${wordData.translationLanguage || ''}</td>
                            <td><input type="text" value="${wordData.word || ''}" class="form-control word"></td>
                            <td><input type="text" value="${wordData.translation || ''}" class="form-control translation"></td>
                            <td><input type="text" value="${wordData.definition || ''}" class="form-control definition"></td>
                            <td><input type="text" value="${wordData.example || ''}" class="form-control example"></td>
                            <td><input type="url" value="${wordData.imageLink || ''}" class="form-control imageLink"></td>
                            <td><input type="url" value="${wordData.audioLink || ''}" class="form-control audioLink"></td>
                        </tr>
                    `;
                });
                dataTable.innerHTML = tableHeader + tableRows;
                console.log('Displaying data:', jsonData);
            }

            addRowButton.addEventListener('click', () => {
                const newRow = `
                    <tr>
                        <td><input type="radio" name="rowSelect" class="rowSelect" data-index="${data.length}"></td>
                        <td>${languageSelect.value}</td>
                        <td>${translationLanguageSelect.value}</td>
                        <td><input type="text" class="form-control word"></td>
                        <td><input type="text" class="form-control translation"></td>
                        <td><input type="text" class="form-control definition"></td>
                        <td><input type="text" class="form-control example"></td>
                        <td><input type="url" class="form-control imageLink"></td>
                        <td><input type="url" class="form-control audioLink"></td>
                    </tr>
                `;
                dataTable.insertAdjacentHTML('beforeend', newRow);
            });

            deleteRowButton.addEventListener('click', () => {
                const selectedRow = dataTable.querySelector('input[name="rowSelect"]:checked');
                if (selectedRow) {
                    selectedRowIndex = parseInt(selectedRow.getAttribute('data-index'));
                    dataTable.deleteRow(selectedRow.closest('tr').rowIndex);
                    data.splice(selectedRowIndex, 1);
                }
            });

            let timeout;

            loadAudioPathsButton.addEventListener('click', () => {
                const words = Array.from(dataTable.querySelectorAll('.word')).map(input => input.value);
                console.log(`Loading audio paths for words: ${words.join(', ')}`);
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    fetch('/load-audio-paths', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ words })
                    })
                    .then(response => response.json())
                    .then(paths => {
                        console.log(`Received audio paths: ${paths.join(', ')}`);
                        const audioLinks = dataTable.querySelectorAll('.audioLink');
                        paths.forEach((path, index) => {
                            if (audioLinks[index]) {
                                audioLinks[index].value = path;
                            }
                        });
                    })
                    .catch(error => {
                        console.error(`Error loading audio paths: ${error}`);
                        console.error('Error details:', error);
                    });
                }, 500); // adjust the timeout value as needed
            });

            loadImagePathsButton.addEventListener('click', () => {
                const words = Array.from(dataTable.querySelectorAll('.word')).map(input => input.value);
                console.log(`Loading image paths for words: ${words.join(', ')}`);
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    fetch('/load-image-paths', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ words })
                    })
                    .then(response => response.json())
                    .then(paths => {
                        console.log(`Received image paths: ${paths.join(', ')}`);
                        const imageLinks = dataTable.querySelectorAll('.imageLink');
                        paths.forEach((path, index) => {
                            if (imageLinks[index]) {
                                imageLinks[index].value = path;
                            }
                        });
                    })
                    .catch(error => {
                        console.error(`Error loading image paths: ${error}`);
                        console.error('Error details:', error);
                    });
                }, 500); // adjust the timeout value as needed
            });

            saveChangesButton.addEventListener('click', () => {
                const updatedData = [];
                const tableRows = dataTable.querySelectorAll('tr');
                tableRows.forEach((tableRow, index) => {
                    if (index === 0) return; // Skip the header row
                    const wordData = {
                        language: languageSelect.value,
                        translationLanguage: translationLanguageSelect.value,
                        word: tableRow.querySelector('.word').value,
                        translation: tableRow.querySelector('.translation').value,
                        definition: tableRow.querySelector('.definition').value,
                        example: tableRow.querySelector('.example').value,
                        imageLink: tableRow.querySelector('.imageLink').value,
                        audioLink: tableRow.querySelector('.audioLink').value,
                    };
                    updatedData.push(wordData);
                });

                const fileName = fileNameInput.value || 'data.json';
                const jsonString = JSON.stringify(updatedData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });

            translateRowsButton.addEventListener('click', () => {
                console.log('Button clicked!');
                const rowsToTranslate = Array.from(dataTable.querySelectorAll('tr')).slice(1); // Exclude header row
                console.log(`Rows to translate: ${rowsToTranslate.length}`);
                rowsToTranslate.forEach((row, index) => {
                    const word = row.querySelector('.word').value;
                    console.log(`Translating word: ${word}`);
                    fetch(`/translate-word?word=${encodeURIComponent(word)}&targetLang=${translationLanguageSelect.value}`)
                        .then(response => response.json())
                        .then(translation => {
                            row.querySelector('.translation').value = translation;
                            console.log(`Translated word: ${translation}`);
                        })
                        .catch(error => {
                            console.error('Error translating word:', error);
                            console.error('Error details:', error.stack);
                        });
                });
            });
        });
    </script>
</body>
</html>