<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Language Quiz</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
   .centered {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
   .word-to-translate,.user-translation {
      font-weight: bold;
      font-size: 24px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container mt-5" id="main-container">
    <h1 class="text-center mb-4">Language Quiz</h1>
    <div class="form-group">
      <label for="fileInput">Select JSON File:</label>
      <input type="file" class="form-control-file" id="fileInput" accept=".json">
    </div>
    <button class="btn btn-primary" onclick="fetchData()">Load Data</button>
    <button class="btn btn-secondary" id="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
    <button class="btn btn-info" onclick="toggleDirection()">Toggle Direction</button>

    <div id="quiz" style="display: none;">
      <div class="card mt-3">
        <div class="card-body text-center">
          <h5 class="card-title">Translate the word:</h5>
          <p class="word-to-translate" id="word"></p>
          <div class="form-group">
            <label for="translation">Enter the translation:</label>
            <input type="text" class="form-control" id="translation" onkeydown="handleKeyDown(event)">
          </div>
          <button class="btn btn-primary mr-2" onclick="checkTranslation()">Check</button>
          <button class="btn btn-success" onclick="generateRandomWord()">Next Word</button>
          <button class="btn btn-warning" id="start-recording" onclick="startRecording()">Start Recording</button>
          <p id="result" class="mt-3"></p>
        </div>
      </div>
    </div>
    <div id="example-sentence">
        <p id="example-sentence-text" style="color: red;"></p><span id="example-sentence-text-content"></span></p>
      </div>

  </div>

  <!-- Bootstrap JS and jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    let words = [];
    let theme = 'light'; // default theme
    let reverseDirection = false;
    let recognition;

    function startRecording() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Web Speech API is not supported by this browser.");
      } else {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;

        // Change the language based on the reverse direction flag
        recognition.lang = reverseDirection ? "en-US" : "pl-PL";

        recognition.onstart = function() {
          console.log("Speech recognition started.");
        };

        recognition.onerror = function(event) {
          console.error("Speech recognition error:", event.error);
        };

        recognition.onend = function() {
          console.log("Speech recognition ended.");
        };

        recognition.onresult = function(event) {
          let finalTranscript = "";
          for (let i = event.resultIndex; i < event.results.length; ++i) {
            if (event.results[i].isFinal) {
              finalTranscript += event.results[i][0].transcript;
            }
          }
          document.getElementById('translation').value = finalTranscript;
        };

        recognition.start();
      }
    }

    function fetchData() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      if (!file) {
        console.error('No file selected.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        const fileContent = event.target.result;
        try {
          words = JSON.parse(fileContent);
          console.log('Data loaded successfully:', words);
          document.getElementById('quiz').style.display = 'block';
          generateRandomWord();
        } catch (error) {
          console.error('Error parsing JSON:', error);
        }
      };
      reader.readAsText(file);
    }

    function generateRandomWord() {
      const randomIndex = Math.floor(Math.random() * words.length);
      const randomWord = words[randomIndex];
      
      // Swap word and translation based on the reverse direction flag
      const displayWord = reverseDirection ? randomWord.translation : randomWord.word;
      const displayTranslation = reverseDirection ? randomWord.word : randomWord.translation;

      document.getElementById('word').innerHTML = `<span class="word-to-translate">${displayWord}</span>`;
      document.getElementById('translation').value = '';
      document.getElementById('result').textContent = '';
      document.getElementById('example-sentence-text').textContent = `${randomWord.example}`;
    }

    function checkTranslation() {
      const userTranslation = document.getElementById('translation').value.trim();
      const currentWord = document.getElementById('word').textContent;

      const correctTranslation = reverseDirection ? 
        words.find(word => word.translation === currentWord).word :
        words.find(word => word.word === currentWord).translation;

      const resultElement = document.getElementById('result');
      if (userTranslation.toLowerCase() === correctTranslation.toLowerCase()) {
        console.log('Correct translation.');
        resultElement.innerHTML = `<span class="user-translation" style="color: green">${userTranslation}</span> - Congratulations! Correct answer.`;
      } else {
        console.log('Incorrect translation.');
        resultElement.innerHTML = `<span class="user-translation" style="color: red">${userTranslation}</span> - Incorrect. The correct translation is: <span class="word-to-translate">${correctTranslation}</span>`;
      }
    }

    function handleKeyDown(event) {
      if (event.key === 'Enter') {
        if (recognition) {
          recognition.stop();
        }
        if (document.getElementById('translation').value.trim() === '') {
          handleEnterKey();
        } else {
          checkTranslation();
        }
      } else if (event.key === 'ArrowRight') {
        generateRandomWord();
      }
    }


    function handleEnterKey() {
      if (document.getElementById('result').textContent === '') {
        const currentWord = document.getElementById('word').textContent;
        const correctTranslation = words.find(word => word.word === currentWord).translation;
        const resultElement = document.getElementById('result');
        resultElement.innerHTML = `Correct translation: <span class="word-to-translate">${correctTranslation}</span>`;
        resultElement.style.color = 'green';
      } else {
        generateRandomWord();
      }
    }

    function toggleTheme() {
      if (theme === 'light') {
        theme = 'dark';
        document.body.classList.add('bg-dark');
        document.body.classList.add('text-light');
        document.getElementById('main-container').classList.add('bg-dark');
        document.getElementById('main-container').classList.add('text-light');
        document.querySelectorAll('.card').forEach(card => {
          card.classList.add('bg-dark');
          card.classList.add('text-light');
        });
        document.querySelectorAll('input').forEach(input => {
          input.classList.add('bg-dark');
          input.classList.add('text-light');
        });
      } else {
        theme = 'light';
        document.body.classList.remove('bg-dark');
        document.body.classList.remove('text-light');
        document.getElementById('main-container').classList.remove('bg-dark');
        document.getElementById('main-container').classList.remove('text-light');
        document.querySelectorAll('.card').forEach(card => {
          card.classList.remove('bg-dark');
          card.classList.remove('text-light');
        });
        document.querySelectorAll('input').forEach(input => {
          input.classList.remove('bg-dark');
          input.classList.remove('text-light');
        });
      }
    }

    function toggleDirection() {
      reverseDirection = !reverseDirection;
      generateRandomWord();
    }
  </script>
</body>
</html>